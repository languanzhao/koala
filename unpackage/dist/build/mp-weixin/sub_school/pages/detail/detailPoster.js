require('../../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["sub_school/pages/detail/detailPoster","common/main"],{"103f":function(e,t,o){},"1bb9":function(e,t,o){},"25d0":function(e,t,o){"use strict";var n=o("103f"),r=o.n(n);r.a},"3d6a":function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,o("c764"),o("921b");var n=p(o("66fd")),r=p(o("93f5")),a=p(o("8df5")),c=o("0f58");o("724a");var i=p(o("5a0b")),s=l(o("3570")),u=p(o("9faf"));function f(){if("function"!==typeof WeakMap)return null;var e=new WeakMap;return f=function(){return e},e}function l(e){if(e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var t=f();if(t&&t.has(e))return t.get(e);var o={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var a=n?Object.getOwnPropertyDescriptor(e,r):null;a&&(a.get||a.set)?Object.defineProperty(o,r,a):o[r]=e[r]}return o.default=e,t&&t.set(e,o),o}function p(e){return e&&e.__esModule?e:{default:e}}function d(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function h(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?d(Object(o),!0).forEach((function(t){g(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):d(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function g(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}n.default.prototype.$store=a.default,n.default.prototype.$baseUrl="https://shop.test.gzzhongw.net/",n.default.prototype.$http=c.request,n.default.prototype.$projectUrl="https://koala.gzzhongw.net/",n.default.prototype.$contactPhone="13544412322",n.default.prototype.$eventHub=n.default.prototype.$eventHub||new n.default,n.default.use(i.default),Object.keys(s).forEach((function(e){n.default.filter(e,s[e])})),n.default.use(u.default);var m=function(){o.e("components/uni-popup/uni-popup").then(function(){return resolve(o("ea22"))}.bind(null,o)).catch(o.oe)};n.default.component("uni-popup",m),n.default.config.productionTip=!1,r.default.mpType="app";var b=new n.default(h({},r.default,{store:a.default})),v=b;t.default=v,e(b).$mount()}).call(this,o("543d")["createApp"])},"3f0d":function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(o("66fd")),r=(a(o("5a47")),o("2f62"));function a(e){return e&&e.__esModule?e:{default:e}}function c(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function i(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?c(Object(o),!0).forEach((function(t){s(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):c(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function s(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var u={globalData:{invitedCode:"",historyRecord:[]},mounted:function(){},methods:i({},(0,r.mapMutations)(["setUserInfo","saveToken","setRoles"]),{checkIsPc:function(){var t=/iOS|Android/i;e.getSystemInfo({success:function(e){e.windowWidth>420&&!window.top.isPC&&!t.test(e.system)&&(window.location.pathname="/static/PC.html")}})},getStatusBarheight:function(){e.getSystemInfo({success:function(e){n.default.prototype.$statusBar=e.statusBarHeight;var t=wx.getMenuButtonBoundingClientRect();console.log(t,"wx"),n.default.prototype.$wxRightMargin=e.screenWidth-t.left,n.default.prototype.$customBar=t.bottom+t.top-e.statusBarHeight}})},getUserInfo:function(){var t=this,o=e.getStorageSync("userInfo").id;if(o){e.getStorage({key:"userInfo",success:function(e){t.setUserInfo(e.data)}});var n=e.getStorageSync("objToken"),r=e.getStorageSync("roles");this.saveToken(n),this.setRoles(r),console.log(r,"roles")}}}),onLaunch:function(){this.getStatusBarheight(),this.getUserInfo()},onShow:function(){},onHide:function(){}};t.default=u}).call(this,o("543d")["default"])},"66af":function(e,t,o){"use strict";var n=o("726d"),r=o.n(n);r.a},"726d":function(e,t,o){},"76e4":function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(o("5fc9")),r=o("2f62"),a=o("a33c"),c=i(o("5a47"));function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function u(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?s(Object(o),!0).forEach((function(t){f(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):s(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function f(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var l={components:{},data:function(){return{posterShow:!1,currentImage:"",schoolInfo:{},textarea:"",posterCanvasImage:"",posterImage:"",maskBool:!1,shareImgList:[]}},computed:u({},(0,r.mapState)(["userInfo"])),onLoad:function(e){var t=this;e.info&&(this.schoolInfo=JSON.parse(decodeURIComponent(e.info)),this.textarea=this.schoolInfo.description||"择校好难？你是没有使用考拉上学吧！收录百大院校，求学有考拉上学，我的前途不迷茫",this.getSchoolImages().then((function(){t.make_wx()})))},methods:{make_wx:function(){var t=this,o={page:"sub_school/pages/detail/index"};this.userInfo.koala.code?o.scene=this.schoolInfo.id+","+this.userInfo.koala.code:o.scene=this.schoolInfo.id,this.$http({api:c.default.weappcode,method:"POST",params:o,header:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(o){e.getImageInfo({src:o.data.path,success:function(e){t.posterCanvasImage=e.path}})})).catch((function(e){}))},downLoadPoster:function(){var t=this;(0,a.checkAuthSetting)("scope.writePhotosAlbum").then((function(){e.saveImageToPhotosAlbum({filePath:t.posterImage,success:function(){e.showToast({title:"保存成功, 可分享好友或朋友圈",icon:"none"})},fail:function(e){}})}))},getSchoolImages:function(){var e=this;return new Promise((function(t,o){e.imageList;e.$http({api:c.default.schoolImages,method:"GET",params:{page:1,"filter[school_id]":e.schoolInfo.id}}).then((function(o){var n=[],r=o.data.data;if(r.length>0){n=r.length>=3?r.slice(0,3):r.slice(0,r.length);var a=n.map((function(e){return e.image_url}));e.shareImgList=a,e.currentImage=a[0]}else e.shareImgList=[e.$projectUrl+"koala_images/poster/02.png",e.$projectUrl+"koala_images/poster/01.png",e.$projectUrl+"koala_images/poster/03.png"],e.currentImage=e.shareImgList[0];t()})).catch((function(e){o()}))}))},cancelMask:function(){this.maskBool=!1},make:function(){var t=this,o=this.$projectUrl+"h6/#/sub_school/pages/detail/index?id="+this.schoolInfo.id;this.userInfo.koala.code&&(o=o+"&invitedCode="+this.userInfo.koala.code),n.default.make({canvasId:"ercodeCanvas",text:o,size:100,success:function(o){e.getImageInfo({src:o,success:function(e){t.posterCanvasImage=o}})}})},chooseImg:function(e){this.currentImage=this.shareImgList[e]},posterCanvas:function(){var t=this;this.maskBool=!0,e.showLoading({title:"生成中..."}),e.getImageInfo({src:this.currentImage,success:function(o){var n=e.createCanvasContext("posterCanvas",t);n.setFillStyle("#fff"),n.fillRect(0,0,270,410),n.drawImage(o.path,0,70,270,220),n.setFillStyle("#000"),n.setFontSize(12),(0,a.canvasText)(n,t.textarea||"择校好难？你是没有使用考拉上学吧！收录百大院校，求学有考拉上学，我的前途不迷茫",10,310,15),n.stroke(),n.setFillStyle("#000"),n.setFontSize(16),n.fillText(t.schoolInfo.name,20,20),n.stroke(),n.drawImage("/static/image/icon/icon_protype.png",20,36,10,10),n.setFillStyle("#666"),n.setFontSize(12),n.fillText(t.schoolInfo.education||" "+t.schoolInfo.property||"",36,46),n.stroke(),(t.schoolInfo.province||t.schoolInfo.city||t.schoolInfo.district)&&(n.drawImage("/static/image/icon/icon_area.png",120,35,8,12),n.setFillStyle("#666"),n.setFontSize(12),n.fillText(t.schoolInfo.province||" "+t.schoolInfo.city||" "+t.schoolInfo.district||"",134,46),n.stroke()),n.drawImage(t.posterCanvasImage,210,300,50,50),n.stroke(),t.userInfo.koala.code&&(n.setFontSize(12),n.fillText("邀请码",216,370),n.stroke(),n.setFontSize(12),n.fillText(t.userInfo.koala.code,208,390),n.stroke()),n.draw(),setTimeout((function(){e.canvasToTempFilePath({canvasId:"posterCanvas",success:function(o){t.posterImage=o.tempFilePath,e.hideLoading(),t.posterShow=!0}})}),500)}})}}};t.default=l}).call(this,o("543d")["default"])},"7f3e":function(e,t,o){"use strict";(function(e){o("c764"),o("921b");n(o("66fd"));var t=n(o("9711"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("543d")["createPage"])},8936:function(e,t,o){"use strict";o.r(t);var n=o("76e4"),r=o.n(n);for(var a in n)"default"!==a&&function(e){o.d(t,e,(function(){return n[e]}))}(a);t["default"]=r.a},"93f5":function(e,t,o){"use strict";o.r(t);var n=o("ca04");for(var r in n)"default"!==r&&function(e){o.d(t,e,(function(){return n[e]}))}(r);o("d841");var a,c,i,s,u=o("f0c5"),f=Object(u["a"])(n["default"],a,c,!1,null,null,null,!1,i,s);t["default"]=f.exports},9711:function(e,t,o){"use strict";o.r(t);var n=o("b818"),r=o("8936");for(var a in r)"default"!==a&&function(e){o.d(t,e,(function(){return r[e]}))}(a);o("66af"),o("25d0");var c,i=o("f0c5"),s=Object(i["a"])(r["default"],n["b"],n["c"],!1,null,"0d487e83",null,!1,n["a"],c);t["default"]=s.exports},b818:function(e,t,o){"use strict";var n,r=function(){var e=this,t=e.$createElement;e._self._c},a=[];o.d(t,"b",(function(){return r})),o.d(t,"c",(function(){return a})),o.d(t,"a",(function(){return n}))},ca04:function(e,t,o){"use strict";o.r(t);var n=o("3f0d"),r=o.n(n);for(var a in n)"default"!==a&&function(e){o.d(t,e,(function(){return n[e]}))}(a);t["default"]=r.a},d841:function(e,t,o){"use strict";var n=o("1bb9"),r=o.n(n);r.a}},[["7f3e","common/runtime","common/vendor"]]]);